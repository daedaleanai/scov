image: nixos/latest
packages:
  - nixos.go
  - nixos.golangci-lint
secrets:
  - 9853f30c-f288-4c16-bde4-9614105439eb
tasks:
  - build: |
      cd scov
      export VERSION=`git describe`
      nix-shell --pure --command 'go build -v -ldflags="-X main.versionInformation=${VERSION}"'
  - test: |
      cd scov
      nix-shell --pure --command "go test -v ."
      nix-shell --arg enableLint true --pure --command "golangci-lint run -v --enable=ineffassign,govet,misspell ."
  - release: |
      cd scov
      nix-build
      cp result/bin/scov scov
  - coverprofile: |
      cd scov
      go test -coverprofile=cover.out
      go tool cover -html=cover.out -o=cover.html
artifacts:
  - scov/cover.html
  - scov/scov
